<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.24.0 by Michael Rose
  Copyright 2013-2020 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>[RxDataSource] 4. 버튼 액션을 클로저 이벤트로 전달하기 - DongHyeon Kim’s Blog</title>
<meta name="description" content="기존 코드 개선 // MARK: - 한번 그려지고 끝나기 때문에 추가/삭제같은 이벤트를 반영할 수 없다. let data = Observable&lt;[RxTodo]&gt;.just(RxTodo.getDumies()) data.bind(to: myTableView.rx.items(cellIdentifier: &quot;RxTodoCell&quot;, cellType: RxTodoCell.self)) {     index, model, cell in     cell.configure(with: model) }  // =&gt; BehaviorRelay를 사용하여 단발성이 아닌 변화가능한 상태를 가진 스트림을 만들어서 사용하자. // MARK: - Relay는 Subject계열인데 끊어지지 않는다(.value로 접근시 마지막 데이터 확인가능 = stateful) var rxTodosRelay: BehaviorRelay&lt;[RxTodo]&gt; = BehaviorRelay(value: RxTodo.getDumies()) rxTodosRelay     .bind(to: myTableView.rx.items) { (tableView, row, element) in         guard let cell = tableView.dequeueReusableCell(withIdentifier: RxTodoCell.reuseIdentifier) as? RxTodoCell else { return UITableViewCell()}         cell.configure(with: element)         return cell     }     .disposed(by: disposeBag)  이전 포스팅에서 아래와 같이 더미 데이터를 한 번만 방출하도록 설정하였다.   이 코드는 초기 데이터만 표시하고 변화가 될 수 없기 때문에 한계가 있다.   // MARK: - 3초뒤 갱신 DispatchQueue.main.asyncAfter(deadline: .now() + 3) {     self.rxTodosRelay.accept(RxTodo.getDumies(count: 3)) }  // MARK: - Rx스러운 3초뒤 갱신 Observable.just(())     .delay(.seconds(3), scheduler: MainScheduler.instance) // Observable&lt;Void&gt;     .map { RxTodo.getDumies(count: 5) }                    // Observable&lt;[RxTodo]&gt;     .bind(onNext: self.rxTodosRelay.accept(_:))            // 같은 자료형이면 클로저가 들어갈 수 있다     .disposed(by: disposeBag)  기존 딜레이 코드를 Rx스럽게 변경도 된다 동일한 로직이다.   RxDataSource RxDataSource는 Relay 같은 Observable이 갱신되면 렌더링이 된다. 지금 코드에서 todosRelay를 BehaviorRelay로 사용한 이유는 마지막 데이터를 알아야 CRUD를 진행할 수 있기 때문이다.   // MARK: - 버튼 연결 addButton.rx.tap     .bind(onNext: { [weak self] _ in         guard let self = self else { return }         var currentTodos = self.rxTodosRelay.value // .value 하면 마지막에 보낸 데이터 할 수 있음         currentTodos.insert(RxTodo(), at: 0)       // 첫번째 열에 넣겠다         self.rxTodosRelay.accept(currentTodos)     })     .disposed(by: disposeBag)  crud 기능을 위해 추가 버튼을 만들었다.    맨위에서부터 데이터를 들어가게 하기위해 insert를 사용했으나 아래에 넣고싶으면 append를 사용하면된다.   // ✅ 2. (더 유연하지만 수동 캐스팅 필요 – RxCocoa) rxTodosRelay     .bind(to: myTableView.rx.items) { (tableView, row, element) in         guard let cell = tableView.dequeueReusableCell(withIdentifier: RxTodoCell.reuseIdentifier) as? RxTodoCell else { return UITableViewCell()}         cell.configure(with: element)                  // MARK: - 셀의 delete버튼 선택되었을 때 액션을 여기서 처리         cell.deleteAction = { id in             let currentTodos = self.rxTodosRelay.value             let filteredTodos = currentTodos.filter { $0.id != id }             self.rxTodosRelay.accept(filteredTodos)         }                  // MARK: - 셀의 토글 클릭시 액션을 여기서 처리         cell.isDoneChange = { [weak self] id, updatedIsDone in             guard let self = self else { return }             var currentTodos = self.rxTodosRelay.value             // 일치하는것 찾기             if let foundTodoIndex = currentTodos.firstIndex(where: { $0.id == id }) {                 currentTodos[foundTodoIndex].isDone = updatedIsDone             }             self.rxTodosRelay.accept(currentTodos)         }                  return cell     }     .disposed(by: disposeBag)  커스텀 셀에서 만든 클로저 버튼 액션 내부 로직을 직접 구현해준다.   이제 두가지 문제가 있는데 다음 포스팅에서 진행하겠다.    버튼도 그냥 addTarget말고 Rx로 연결하는게 어떨까?   토글시 애니메이션이 전혀 없어서 어색하게 보인다    전체 코드 // Model import Fakery import UIKit  // MARK: - Model struct RxTodo {     let id: UUID = UUID()     let title: String     var isDone: Bool      init(title: String? = nil,          isDone: Bool = false     ) {         self.title = title ?? &quot;터이틀: \(id.uuidString.prefix(8))&quot;         self.isDone = isDone     }      static func getDumies(count: Int = 10) -&gt; [RxTodo] {         let faker = Faker(locale: &quot;ko&quot;)         var result: [RxTodo] = []          for _ in 1...count {             let firstName = faker.name.firstName()             let lastName = faker.name.lastName()             let title = &quot;\(lastName) \(firstName)&quot;             result.append(RxTodo(title: title, isDone: false))         }         return result     } }   // Cell import UIKit import RxSwift import RxCocoa  final class RxTodoCell: UITableViewCell {      var cellData: RxTodo? = nil      // MARK: - Rx     var disposeBag = DisposeBag()     var isDoneChange: ((_ id: UUID, _ newValue: Bool) -&gt; Void)? = nil     var deleteAction: ((_ id: UUID) -&gt; Void)? = nil      private let titleLabel: UILabel = {         let label = UILabel()         label.text = &quot;제목&quot;         label.numberOfLines = 1         label.font = UIFont.systemFont(ofSize: 14, weight: .bold)         return label     }()      private let idLabel: UILabel = {         let label = UILabel()         label.text = &quot;아이디&quot;         label.numberOfLines = 0         label.font = UIFont.systemFont(ofSize: 12, weight: .regular)         return label     }()      private lazy var isDoneSwitch: UISwitch = {         let sw = UISwitch()         return sw     }()      private lazy var deleteButton: UIButton = {         let btn = UIButton(type: .system)         btn.setTitle(&quot;Delete&quot;, for: .normal)         btn.widthAnchor.constraint(equalToConstant: 50).isActive = true         return btn     }()      private lazy var vStack: UIStackView = {         let stack = UIStackView(arrangedSubviews: [titleLabel, idLabel])         stack.axis = .vertical         stack.spacing = 8         return stack     }()      private lazy var hStack: UIStackView = {         let stack = UIStackView(arrangedSubviews: [vStack, isDoneSwitch, deleteButton])         stack.axis = .horizontal         stack.alignment = .center         stack.spacing = 20         return stack     }()      override init(style: UITableViewCell.CellStyle, reuseIdentifier: String?) {         super.init(style: style, reuseIdentifier: reuseIdentifier)         makeUI()         constraints()                  // MARK: - 버튼 연결         isDoneSwitch.addTarget(self, action: #selector(handleIsDone), for: .valueChanged)         deleteButton.addTarget(self, action: #selector(handleDeleteButton), for: .touchUpInside)     }      required init?(coder: NSCoder) {         fatalError(&quot;init(coder:) has not been implemented&quot;)     }      private func makeUI() {         [hStack].forEach {             contentView.addSubview($0)             $0.translatesAutoresizingMaskIntoConstraints = false         }     }      private func constraints() {         NSLayoutConstraint.activate([             hStack.topAnchor.constraint(equalTo: contentView.topAnchor, constant: 10),             hStack.leadingAnchor.constraint(equalTo: contentView.leadingAnchor, constant: 20),             hStack.trailingAnchor.constraint(equalTo: contentView.trailingAnchor, constant: -20),             hStack.bottomAnchor.constraint(equalTo: contentView.bottomAnchor, constant: -10),         ])     }      override func prepareForReuse() {         super.prepareForReuse()         print(#fileID, #function, #line, &quot;prepareForReuse() - cellData.id: \(cellData?.id ?? UUID())&quot;)         self.disposeBag = DisposeBag()     } }  extension RxTodoCell {     func configure(with todo: RxTodo) {         self.cellData = todo         titleLabel.text = todo.title          let idString = String(todo.id.uuidString.prefix(10))         idLabel.text = &quot;ID: \(idString)&quot;         isDoneSwitch.isOn = todo.isDone         // setRx()     }       // MARK: - 디버깅용     func configure(title: String, id: Int) {         titleLabel.text = title         idLabel.text = &quot;ID: \(id)&quot;         isDoneSwitch.isOn = false      } }  extension RxTodoCell {     @objc func handleIsDone(_ sender: UISwitch) {         print(#fileID, #function, #line, &quot;- id: \(cellData?.id.uuidString ?? &quot;&quot;) sender: \(sender.isOn)&quot;)         guard let id = self.cellData?.id else { return }         isDoneChange?(id, sender.isOn)     }          @objc func handleDeleteButton(_ sender: UIButton) {         guard let id = self.cellData?.id else { return }         deleteAction?(id)     } }  #if DEBUG import SwiftUI // TodoCell 미리보기 struct RxTodoCell_Preview: PreviewProvider {     static var previews: some View {         let cell = RxTodoCell()         cell.configure(title: &quot;할 일 예제&quot;, id: 42)         return cell.contentView             .getPreview()             .previewLayout(.fixed(width: 350, height: 100))             .background(Color.white)     } } #endif   // ViewController import UIKit import RxSwift import RxCocoa import RxRelay  final class RxTodoViewController2: UIViewController {      // MARK: - 구독에 대한 찌꺼기 처리     var disposeBag =  DisposeBag()          // MARK: - Relay는 Subject계열인데 끊어지지 않는다(.value로 접근시 마지막 데이터 확인가능 = stateful)     var rxTodosRelay: BehaviorRelay&lt;[RxTodo]&gt; = BehaviorRelay(value: RxTodo.getDumies())      // MARK: - UI     private lazy var addButton = UIBarButtonItem(title: &quot;추가&quot;,                                                  style: .plain,                                                  target: nil,                                                  action: nil)      private lazy var myTableView: UITableView = {         let tv = UITableView()         return tv     }()      override func viewDidLoad() {         super.viewDidLoad()         view.backgroundColor = .white         makeUI()         constraints()                  // MARK: - 코드기반 사용한다면         myTableView.register(RxTodoCell.self, forCellReuseIdentifier: &quot;RxTodoCell&quot;)                  // ✅ 1. RxTodoCell을 타입으로 명시하여 바인딩하는 간결한 방식         /*          data.bind(to: myTableView.rx.items(cellIdentifier: RxTodoCell.reuseIdentifier,                                             cellType: RxTodoCell.self)) { index, model, cell in              cell.configure(with: model)          }         .disposed(by: disposeBag)          */                           // ✅ 2. (더 유연하지만 수동 캐스팅 필요 – RxCocoa)         rxTodosRelay             .bind(to: myTableView.rx.items) { (tableView, row, element) in                 guard let cell = tableView.dequeueReusableCell(withIdentifier: RxTodoCell.reuseIdentifier) as? RxTodoCell else { return UITableViewCell()}                 cell.configure(with: element)                                  // MARK: - 셀의 delete버튼 선택되었을 때 액션을 여기서 처리                 cell.deleteAction = { id in                     let currentTodos = self.rxTodosRelay.value                     let filteredTodos = currentTodos.filter { $0.id != id }                     self.rxTodosRelay.accept(filteredTodos)                 }                                  // MARK: - 셀의 토글 클릭시 액션을 여기서 처리                 cell.isDoneChange = { [weak self] id, updatedIsDone in                     guard let self = self else { return }                     var currentTodos = self.rxTodosRelay.value                     // 일치하는것 찾기                     if let foundTodoIndex = currentTodos.firstIndex(where: { $0.id == id }) {                         currentTodos[foundTodoIndex].isDone = updatedIsDone                     }                     self.rxTodosRelay.accept(currentTodos)                 }                                  return cell             }             .disposed(by: disposeBag)                           // MARK: - 3초뒤 갱신         /*         DispatchQueue.main.asyncAfter(deadline: .now() + 3) {             self.rxTodosRelay.accept(RxTodo.getDumies(count: 3))         }          */                  // MARK: - Rx스러운 3초뒤 갱신         /*         Observable.just(())             .delay(.seconds(3), scheduler: MainScheduler.instance) // Observable&lt;Void&gt;             .map { RxTodo.getDumies(count: 5) }                    // Observable&lt;[RxTodo]&gt;             .bind(onNext: self.rxTodosRelay.accept(_:))            // 같은 자료형이면 클로저가 들어갈 수 있다             .disposed(by: disposeBag)         */                  // MARK: - 버튼 연결         addButton.rx.tap             .bind(onNext: { [weak self] _ in                 guard let self = self else { return }                 var currentTodos = self.rxTodosRelay.value // .value 하면 마지막에 보낸 데이터 할 수 있음                 currentTodos.insert(RxTodo(), at: 0)       // 첫번째 열에 넣겠다                 self.rxTodosRelay.accept(currentTodos)             })             .disposed(by: disposeBag)     }          private func makeUI() {         [myTableView].forEach {             view.addSubview($0)             $0.translatesAutoresizingMaskIntoConstraints = false         }                  // 네비게이션 버튼         navigationItem.rightBarButtonItems = [addButton]     }          private func constraints() {         NSLayoutConstraint.activate([             myTableView.topAnchor.constraint(equalTo: view.safeAreaLayoutGuide.topAnchor),             myTableView.leadingAnchor.constraint(equalTo: view.leadingAnchor),             myTableView.trailingAnchor.constraint(equalTo: view.trailingAnchor),             myTableView.bottomAnchor.constraint(equalTo: view.bottomAnchor)         ])     } }">


  <meta name="author" content="Dong Hyeon">
  
  <meta property="article:author" content="Dong Hyeon">
  


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="DongHyeon Kim's Blog">
<meta property="og:title" content="[RxDataSource] 4. 버튼 액션을 클로저 이벤트로 전달하기">
<meta property="og:url" content="http://localhost:4000/RxDataSource-RxDataSource-4/">


  <meta property="og:description" content="기존 코드 개선 // MARK: - 한번 그려지고 끝나기 때문에 추가/삭제같은 이벤트를 반영할 수 없다. let data = Observable&lt;[RxTodo]&gt;.just(RxTodo.getDumies()) data.bind(to: myTableView.rx.items(cellIdentifier: &quot;RxTodoCell&quot;, cellType: RxTodoCell.self)) {     index, model, cell in     cell.configure(with: model) }  // =&gt; BehaviorRelay를 사용하여 단발성이 아닌 변화가능한 상태를 가진 스트림을 만들어서 사용하자. // MARK: - Relay는 Subject계열인데 끊어지지 않는다(.value로 접근시 마지막 데이터 확인가능 = stateful) var rxTodosRelay: BehaviorRelay&lt;[RxTodo]&gt; = BehaviorRelay(value: RxTodo.getDumies()) rxTodosRelay     .bind(to: myTableView.rx.items) { (tableView, row, element) in         guard let cell = tableView.dequeueReusableCell(withIdentifier: RxTodoCell.reuseIdentifier) as? RxTodoCell else { return UITableViewCell()}         cell.configure(with: element)         return cell     }     .disposed(by: disposeBag)  이전 포스팅에서 아래와 같이 더미 데이터를 한 번만 방출하도록 설정하였다.   이 코드는 초기 데이터만 표시하고 변화가 될 수 없기 때문에 한계가 있다.   // MARK: - 3초뒤 갱신 DispatchQueue.main.asyncAfter(deadline: .now() + 3) {     self.rxTodosRelay.accept(RxTodo.getDumies(count: 3)) }  // MARK: - Rx스러운 3초뒤 갱신 Observable.just(())     .delay(.seconds(3), scheduler: MainScheduler.instance) // Observable&lt;Void&gt;     .map { RxTodo.getDumies(count: 5) }                    // Observable&lt;[RxTodo]&gt;     .bind(onNext: self.rxTodosRelay.accept(_:))            // 같은 자료형이면 클로저가 들어갈 수 있다     .disposed(by: disposeBag)  기존 딜레이 코드를 Rx스럽게 변경도 된다 동일한 로직이다.   RxDataSource RxDataSource는 Relay 같은 Observable이 갱신되면 렌더링이 된다. 지금 코드에서 todosRelay를 BehaviorRelay로 사용한 이유는 마지막 데이터를 알아야 CRUD를 진행할 수 있기 때문이다.   // MARK: - 버튼 연결 addButton.rx.tap     .bind(onNext: { [weak self] _ in         guard let self = self else { return }         var currentTodos = self.rxTodosRelay.value // .value 하면 마지막에 보낸 데이터 할 수 있음         currentTodos.insert(RxTodo(), at: 0)       // 첫번째 열에 넣겠다         self.rxTodosRelay.accept(currentTodos)     })     .disposed(by: disposeBag)  crud 기능을 위해 추가 버튼을 만들었다.    맨위에서부터 데이터를 들어가게 하기위해 insert를 사용했으나 아래에 넣고싶으면 append를 사용하면된다.   // ✅ 2. (더 유연하지만 수동 캐스팅 필요 – RxCocoa) rxTodosRelay     .bind(to: myTableView.rx.items) { (tableView, row, element) in         guard let cell = tableView.dequeueReusableCell(withIdentifier: RxTodoCell.reuseIdentifier) as? RxTodoCell else { return UITableViewCell()}         cell.configure(with: element)                  // MARK: - 셀의 delete버튼 선택되었을 때 액션을 여기서 처리         cell.deleteAction = { id in             let currentTodos = self.rxTodosRelay.value             let filteredTodos = currentTodos.filter { $0.id != id }             self.rxTodosRelay.accept(filteredTodos)         }                  // MARK: - 셀의 토글 클릭시 액션을 여기서 처리         cell.isDoneChange = { [weak self] id, updatedIsDone in             guard let self = self else { return }             var currentTodos = self.rxTodosRelay.value             // 일치하는것 찾기             if let foundTodoIndex = currentTodos.firstIndex(where: { $0.id == id }) {                 currentTodos[foundTodoIndex].isDone = updatedIsDone             }             self.rxTodosRelay.accept(currentTodos)         }                  return cell     }     .disposed(by: disposeBag)  커스텀 셀에서 만든 클로저 버튼 액션 내부 로직을 직접 구현해준다.   이제 두가지 문제가 있는데 다음 포스팅에서 진행하겠다.    버튼도 그냥 addTarget말고 Rx로 연결하는게 어떨까?   토글시 애니메이션이 전혀 없어서 어색하게 보인다    전체 코드 // Model import Fakery import UIKit  // MARK: - Model struct RxTodo {     let id: UUID = UUID()     let title: String     var isDone: Bool      init(title: String? = nil,          isDone: Bool = false     ) {         self.title = title ?? &quot;터이틀: \(id.uuidString.prefix(8))&quot;         self.isDone = isDone     }      static func getDumies(count: Int = 10) -&gt; [RxTodo] {         let faker = Faker(locale: &quot;ko&quot;)         var result: [RxTodo] = []          for _ in 1...count {             let firstName = faker.name.firstName()             let lastName = faker.name.lastName()             let title = &quot;\(lastName) \(firstName)&quot;             result.append(RxTodo(title: title, isDone: false))         }         return result     } }   // Cell import UIKit import RxSwift import RxCocoa  final class RxTodoCell: UITableViewCell {      var cellData: RxTodo? = nil      // MARK: - Rx     var disposeBag = DisposeBag()     var isDoneChange: ((_ id: UUID, _ newValue: Bool) -&gt; Void)? = nil     var deleteAction: ((_ id: UUID) -&gt; Void)? = nil      private let titleLabel: UILabel = {         let label = UILabel()         label.text = &quot;제목&quot;         label.numberOfLines = 1         label.font = UIFont.systemFont(ofSize: 14, weight: .bold)         return label     }()      private let idLabel: UILabel = {         let label = UILabel()         label.text = &quot;아이디&quot;         label.numberOfLines = 0         label.font = UIFont.systemFont(ofSize: 12, weight: .regular)         return label     }()      private lazy var isDoneSwitch: UISwitch = {         let sw = UISwitch()         return sw     }()      private lazy var deleteButton: UIButton = {         let btn = UIButton(type: .system)         btn.setTitle(&quot;Delete&quot;, for: .normal)         btn.widthAnchor.constraint(equalToConstant: 50).isActive = true         return btn     }()      private lazy var vStack: UIStackView = {         let stack = UIStackView(arrangedSubviews: [titleLabel, idLabel])         stack.axis = .vertical         stack.spacing = 8         return stack     }()      private lazy var hStack: UIStackView = {         let stack = UIStackView(arrangedSubviews: [vStack, isDoneSwitch, deleteButton])         stack.axis = .horizontal         stack.alignment = .center         stack.spacing = 20         return stack     }()      override init(style: UITableViewCell.CellStyle, reuseIdentifier: String?) {         super.init(style: style, reuseIdentifier: reuseIdentifier)         makeUI()         constraints()                  // MARK: - 버튼 연결         isDoneSwitch.addTarget(self, action: #selector(handleIsDone), for: .valueChanged)         deleteButton.addTarget(self, action: #selector(handleDeleteButton), for: .touchUpInside)     }      required init?(coder: NSCoder) {         fatalError(&quot;init(coder:) has not been implemented&quot;)     }      private func makeUI() {         [hStack].forEach {             contentView.addSubview($0)             $0.translatesAutoresizingMaskIntoConstraints = false         }     }      private func constraints() {         NSLayoutConstraint.activate([             hStack.topAnchor.constraint(equalTo: contentView.topAnchor, constant: 10),             hStack.leadingAnchor.constraint(equalTo: contentView.leadingAnchor, constant: 20),             hStack.trailingAnchor.constraint(equalTo: contentView.trailingAnchor, constant: -20),             hStack.bottomAnchor.constraint(equalTo: contentView.bottomAnchor, constant: -10),         ])     }      override func prepareForReuse() {         super.prepareForReuse()         print(#fileID, #function, #line, &quot;prepareForReuse() - cellData.id: \(cellData?.id ?? UUID())&quot;)         self.disposeBag = DisposeBag()     } }  extension RxTodoCell {     func configure(with todo: RxTodo) {         self.cellData = todo         titleLabel.text = todo.title          let idString = String(todo.id.uuidString.prefix(10))         idLabel.text = &quot;ID: \(idString)&quot;         isDoneSwitch.isOn = todo.isDone         // setRx()     }       // MARK: - 디버깅용     func configure(title: String, id: Int) {         titleLabel.text = title         idLabel.text = &quot;ID: \(id)&quot;         isDoneSwitch.isOn = false      } }  extension RxTodoCell {     @objc func handleIsDone(_ sender: UISwitch) {         print(#fileID, #function, #line, &quot;- id: \(cellData?.id.uuidString ?? &quot;&quot;) sender: \(sender.isOn)&quot;)         guard let id = self.cellData?.id else { return }         isDoneChange?(id, sender.isOn)     }          @objc func handleDeleteButton(_ sender: UIButton) {         guard let id = self.cellData?.id else { return }         deleteAction?(id)     } }  #if DEBUG import SwiftUI // TodoCell 미리보기 struct RxTodoCell_Preview: PreviewProvider {     static var previews: some View {         let cell = RxTodoCell()         cell.configure(title: &quot;할 일 예제&quot;, id: 42)         return cell.contentView             .getPreview()             .previewLayout(.fixed(width: 350, height: 100))             .background(Color.white)     } } #endif   // ViewController import UIKit import RxSwift import RxCocoa import RxRelay  final class RxTodoViewController2: UIViewController {      // MARK: - 구독에 대한 찌꺼기 처리     var disposeBag =  DisposeBag()          // MARK: - Relay는 Subject계열인데 끊어지지 않는다(.value로 접근시 마지막 데이터 확인가능 = stateful)     var rxTodosRelay: BehaviorRelay&lt;[RxTodo]&gt; = BehaviorRelay(value: RxTodo.getDumies())      // MARK: - UI     private lazy var addButton = UIBarButtonItem(title: &quot;추가&quot;,                                                  style: .plain,                                                  target: nil,                                                  action: nil)      private lazy var myTableView: UITableView = {         let tv = UITableView()         return tv     }()      override func viewDidLoad() {         super.viewDidLoad()         view.backgroundColor = .white         makeUI()         constraints()                  // MARK: - 코드기반 사용한다면         myTableView.register(RxTodoCell.self, forCellReuseIdentifier: &quot;RxTodoCell&quot;)                  // ✅ 1. RxTodoCell을 타입으로 명시하여 바인딩하는 간결한 방식         /*          data.bind(to: myTableView.rx.items(cellIdentifier: RxTodoCell.reuseIdentifier,                                             cellType: RxTodoCell.self)) { index, model, cell in              cell.configure(with: model)          }         .disposed(by: disposeBag)          */                           // ✅ 2. (더 유연하지만 수동 캐스팅 필요 – RxCocoa)         rxTodosRelay             .bind(to: myTableView.rx.items) { (tableView, row, element) in                 guard let cell = tableView.dequeueReusableCell(withIdentifier: RxTodoCell.reuseIdentifier) as? RxTodoCell else { return UITableViewCell()}                 cell.configure(with: element)                                  // MARK: - 셀의 delete버튼 선택되었을 때 액션을 여기서 처리                 cell.deleteAction = { id in                     let currentTodos = self.rxTodosRelay.value                     let filteredTodos = currentTodos.filter { $0.id != id }                     self.rxTodosRelay.accept(filteredTodos)                 }                                  // MARK: - 셀의 토글 클릭시 액션을 여기서 처리                 cell.isDoneChange = { [weak self] id, updatedIsDone in                     guard let self = self else { return }                     var currentTodos = self.rxTodosRelay.value                     // 일치하는것 찾기                     if let foundTodoIndex = currentTodos.firstIndex(where: { $0.id == id }) {                         currentTodos[foundTodoIndex].isDone = updatedIsDone                     }                     self.rxTodosRelay.accept(currentTodos)                 }                                  return cell             }             .disposed(by: disposeBag)                           // MARK: - 3초뒤 갱신         /*         DispatchQueue.main.asyncAfter(deadline: .now() + 3) {             self.rxTodosRelay.accept(RxTodo.getDumies(count: 3))         }          */                  // MARK: - Rx스러운 3초뒤 갱신         /*         Observable.just(())             .delay(.seconds(3), scheduler: MainScheduler.instance) // Observable&lt;Void&gt;             .map { RxTodo.getDumies(count: 5) }                    // Observable&lt;[RxTodo]&gt;             .bind(onNext: self.rxTodosRelay.accept(_:))            // 같은 자료형이면 클로저가 들어갈 수 있다             .disposed(by: disposeBag)         */                  // MARK: - 버튼 연결         addButton.rx.tap             .bind(onNext: { [weak self] _ in                 guard let self = self else { return }                 var currentTodos = self.rxTodosRelay.value // .value 하면 마지막에 보낸 데이터 할 수 있음                 currentTodos.insert(RxTodo(), at: 0)       // 첫번째 열에 넣겠다                 self.rxTodosRelay.accept(currentTodos)             })             .disposed(by: disposeBag)     }          private func makeUI() {         [myTableView].forEach {             view.addSubview($0)             $0.translatesAutoresizingMaskIntoConstraints = false         }                  // 네비게이션 버튼         navigationItem.rightBarButtonItems = [addButton]     }          private func constraints() {         NSLayoutConstraint.activate([             myTableView.topAnchor.constraint(equalTo: view.safeAreaLayoutGuide.topAnchor),             myTableView.leadingAnchor.constraint(equalTo: view.leadingAnchor),             myTableView.trailingAnchor.constraint(equalTo: view.trailingAnchor),             myTableView.bottomAnchor.constraint(equalTo: view.bottomAnchor)         ])     } }">







  <meta property="article:published_time" content="2025-09-13T00:00:00+00:00">





  

  


<link rel="canonical" href="http://localhost:4000/RxDataSource-RxDataSource-4/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "indextrown",
      "url": "http://localhost:4000/"
    
  }
</script>







<!-- end _includes/seo.html -->

<!-- 여기에 analytics 추가 -->



  <link href="/feed.xml" type="application/atom+xml" rel="alternate" title="DongHyeon Kim's Blog Feed">


<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
<noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css"></noscript>



<!--JQ cloud-->
<link rel="stylesheet" href="/assets/css/jqcloud.min.css">

<!-- pseudocode.js -->
<script src="/assets/pseudocode.js-2.4.1/pseudocode.js" type="text/javascript"></script>
<link rel="stylesheet" href="/assets/pseudocode.js-2.4.1/pseudocode.css">
    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

<link href="https://fonts.googleapis.com/css2?family=Nanum+Gothic&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=PT+Sans:ital,wght@0,400;0,700;1,400;1,700&display=swap" rel="stylesheet">
<link href="https://hangeul.pstatic.net/hangeul_static/css/nanum-square-neo.css" rel="stylesheet">
<link href="https://hangeul.pstatic.net/hangeul_static/css/nanum-gothic-coding.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">
    <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      extensions: ["tex2jax.js"],
      jax: ["input/TeX", "output/HTML-CSS"],
      tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
        processEscapes: true
      },
      "HTML-CSS": { availableFonts: ["TeX"] }
    });
  </script>
    
  <script type="text/javascript" async
    src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
  </script>
    <script src="https://code.jquery.com/jquery-3.4.1.js"></script>

    <!-- Mermaid.js를 로드 기능 추가 - [index] -->
    <script type="module">
      import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
      mermaid.initialize({ startOnLoad: true });
    </script>

  </head>

  <body class="layout--single">
    <nav class="skip-links">
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    

<script src="https://unpkg.com/ionicons@4.5.10-0/dist/ionicons.js"></script>

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <!-- <a class="site-logo" href="/">
          <img src="/assets/logos/logo.svg" alt="DongHyeon Kim's Blog"></a> -->
        <a class="site-title" href="/">
          @dong_h_kim
          <span class="site-subtitle">iOS Developer Blog</span>
        </a>
        <!-- Dark mode toggle -->
        <!-- <input type="checkbox" id="switch" name="theme">
        <label for="switch" class="switch_label">
          <span class="onf_btn"></span>
        </label> -->
        <script src="https://code.iconify.design/1/1.0.4/iconify.min.js">   </script>
<label class="switch_label">
<input class='toggle-checkbox' type='checkbox'></input>
<div class='toggle-slot'>
    <div class='sun-icon-wrapper'>
    <div class="iconify sun-icon" data-icon="feather-sun" data-inline="false"></div>
    </div>
    <div class='toggle-button'></div>
    <div class='moon-icon-wrapper'>
    <div class="iconify moon-icon" data-icon="feather-moon" data-inline="false"></div>
    </div>
</div>
</label>
  

  
<style>

.toggle-checkbox {
  position: absolute;
  opacity: 0;
  cursor: pointer;
  height: 0;
  width: 0;
}

.toggle-slot {
  position: relative;
  height: 35px; /* Adjusted height for PC */
  width: 70px; /* Adjusted width for PC */
  border: 5px solid #e4e7ec;
  border-radius: 35px; /* Adjusted border-radius for PC */
  background-color: white;
  /* box-shadow: 0px 10px 25px #e4e7ec; */
  transition: background-color 250ms;
}

@media (max-width: 767px) {
  /* Styles for screens less than 768px wide (mobile) */
  .toggle-slot {
    height: 25px; /* Adjusted height for mobile */
    width: 50px; /* Adjusted width for mobile */
    border-radius: 25px; /* Adjusted border-radius for mobile */
    border: 3px solid #e4e7ec;
  }
}

.toggle-checkbox:checked ~ .toggle-slot {
  background-color: #374151;
}

.toggle-button {
  transform: translate(35px, 4px); /* Adjusted position for PC */
  position: absolute;
  height: 17.5px; /* Adjusted height for PC */
  width: 17.5px; /* Adjusted width for PC */
  border-radius: 50%;
  background-color: #ffeccf;
  box-shadow: inset 0px 0px 0px 3.5px #ffbb52; /* Adjusted box-shadow for PC */
  transition: background-color 250ms, border-color 250ms, transform 500ms;
}

@media (max-width: 767px) {
  /* Styles for screens less than 768px wide (mobile) */
  .toggle-button {
    transform: translate(27px, 3.5px); /* Adjusted position for mobile */
    height: 12.5px; /* Adjusted height for mobile */
    width: 12.5px; /* Adjusted width for mobile */
    box-shadow: inset 0px 0px 0px 2.5px #ffbb52; /* Adjusted box-shadow for mobile */
  }
}

.toggle-checkbox:checked ~ .toggle-slot .toggle-button {
  background-color: #485367;
  box-shadow: inset 0px 0px 0px 3.5px white; /* Adjusted box-shadow for PC */
  transform: translate(7px, 4px); /* Adjusted position for PC */
}

@media (max-width: 767px) {
  /* Styles for screens less than 768px wide (mobile) */
  .toggle-checkbox:checked ~ .toggle-slot .toggle-button {
    box-shadow: inset 0px 0px 0px 2.5px white; /* Adjusted box-shadow for mobile */
    transform: translate(4px, 3.5px); /* Adjusted position for mobile */
  }
}

.sun-icon {
  position: absolute;
  height: 18px; /* Adjusted height for PC */
  width: 18px; /* Adjusted width for PC */
  color: #ffbb52;
}

.sun-icon-wrapper {
  position: absolute;
  top: 10%;
  height: 18px; /* Adjusted height for PC */
  width: 18px; /* Adjusted width for PC */
  opacity: 1;
  transform: translate(5px, 1px) rotate(15deg); /* Adjusted position for PC */
  transform-origin: 50% 50%;
  transition: opacity 150ms, transform 500ms;
}

@media (max-width: 767px) {
  /* Styles for screens less than 768px wide (mobile) */
  .sun-icon,
  .sun-icon-wrapper {
    height: 11px; /* Adjusted height for mobile */
    width: 11px; /* Adjusted width for mobile */
    transform: translate(5px, 3px) rotate(15deg); /* Adjusted position for mobile */
  }
}

.toggle-checkbox:checked ~ .toggle-slot .sun-icon-wrapper {
  opacity: 0;
  transform: translate(0px, 1px) rotate(0deg); /* Adjusted position for PC */
}

@media (max-width: 767px) {
  /* Styles for screens less than 768px wide (mobile) */
  .toggle-checkbox:checked ~ .toggle-slot .sun-icon-wrapper {
    transform: translate(2px, 2.5px) rotate(0deg); /* Adjusted position for mobile */
  }
}

.moon-icon {
  position: absolute;
  height: 18px; /* Adjusted height for PC */
  width: 18px; /* Adjusted width for PC */
  color: white;
}

.moon-icon-wrapper {
  position: absolute;
  top: 10%;
  height: 18px; /* Adjusted height for PC */
  width: 18px; /* Adjusted width for PC */
  opacity: 0;
  transform: translate(30px, 1px) rotate(0deg); /* Adjusted position for PC */
  transform-origin: 50% 50%;
  transition: opacity 150ms, transform 500ms;
}

@media (max-width: 767px) {
  /* Styles for screens less than 768px wide (mobile) */
  .moon-icon,
  .moon-icon-wrapper {
    height: 11px; /* Adjusted height for mobile */
    width: 11px; /* Adjusted width for mobile */
    transform: translate(25px, 2.5px) rotate(0deg); /* Adjusted position for mobile */
  }
}

.toggle-checkbox:checked ~ .toggle-slot .moon-icon-wrapper {
  opacity: 1;
  transform: translate(35px, 1px) rotate(-15deg); /* Adjusted position for PC */
}

@media (max-width: 767px) {
  /* Styles for screens less than 768px wide (mobile) */
  .toggle-checkbox:checked ~ .toggle-slot .moon-icon-wrapper {
    transform: translate(28px, 2.5px) rotate(-15deg); /* Adjusted position for mobile */
  }
}


</style>

<script>
var checkbox = document.querySelector('.toggle-checkbox');

// 페이지 로드 시 로컬 스토리지에서 테마 설정을 불러옵니다.
if (localStorage.getItem('theme') === 'dark') {
  checkbox.checked = true;
  document.body.classList.add('dark');
} else {
  checkbox.checked = false;
  document.body.classList.remove('dark');
}

checkbox.addEventListener('change', function() {
  // 테마를 토글하고 로컬 스토리지에 저장합니다.
  // trans();
  document.body.classList.toggle('dark');
  localStorage.setItem('theme', this.checked ? 'dark' : 'light');
});
</script>

        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/about/">About</a>
            </li><li class="masthead__menu-item">
              <a href="/posts/">Articles</a>
            </li><li class="masthead__menu-item">
              <a href="/projects/">Projects</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <i class="fas fa-search"></i>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>

<script>
  $(function(){
  var $header = $('masthead'); //헤더를 변수에 넣기
  var $page = $('.initial-content'); //색상이 변할 부분
  var $window = $(window);
  var pageOffsetTop = $page.offset().top;//색상 변할 부분의 top값 구하기
  
  $window.resize(function(){ //반응형을 대비하여 리사이즈시 top값을 다시 계산
    pageOffsetTop = $page.offset().top;
  });
  
  $window.on('scroll', function(){ //스크롤시
    var scrolled = $window.scrollTop() >= pageOffsetTop; //스크롤된 상태; true or false
    $header.toggleClass('down', scrolled); //클래스 토글
  });
});

// var menuToggleButton = document.querySelector("button.toggle");
// var menuTarget = document.querySelector(".side-menu");
// var menuBlock = document.querySelector("menu");

// function toggleMenuVisibility(){
// 	menuTarget.classList.toggle("side-menu--active");
// 	animateCSS(".menu", "fadeIn");
// }

// function animateCSS(element, animationName, callback) {
//     var node = document.querySelector(element)
//     node.classList.add('animated', animationName)

//     function handleAnimationEnd() {
//         node.classList.remove('animated', animationName)
//         node.removeEventListener('animationend', handleAnimationEnd)

//         if (typeof callback === 'function') callback()
//     }

//     node.addEventListener('animationend', handleAnimationEnd)
// }

// menuToggleButton.addEventListener('click', toggleMenuVisibility);

// Dark mode toggle

var checkbox = document.querySelector('input[name=theme]');

// 페이지 로드 시 로컬 스토리지에서 테마 설정을 불러옵니다.
if (localStorage.getItem('theme') === 'dark') {
  checkbox.checked = true;
  document.body.classList.add('dark');
} else {
  checkbox.checked = false;
  document.body.classList.remove('dark');
}

checkbox.addEventListener('change', function() {
  // 테마를 토글하고 로컬 스토리지에 저장합니다.
  // trans();
  document.body.classList.toggle('dark');
  localStorage.setItem('theme', this.checked ? 'dark' : 'light');
});


// let trans = () => {
//   document.documentElement.classList.add('transition');
//   window.setTimeout(() => {
//     document.documentElement.classList.remove('transition');
//   }, 500);
// }
</script>

    <div class="initial-content">
      





<div id="main" role="main">
  


  <article class="page h-entry" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="[RxDataSource] 4. 버튼 액션을 클로저 이벤트로 전달하기">
    <meta itemprop="description" content="기존 코드 개선// MARK: - 한번 그려지고 끝나기 때문에 추가/삭제같은 이벤트를 반영할 수 없다.let data = Observable&lt;[RxTodo]&gt;.just(RxTodo.getDumies())data.bind(to: myTableView.rx.items(cellIdentifier: &quot;RxTodoCell&quot;, cellType: RxTodoCell.self)) {    index, model, cell in    cell.configure(with: model)}// =&gt; BehaviorRelay를 사용하여 단발성이 아닌 변화가능한 상태를 가진 스트림을 만들어서 사용하자.// MARK: - Relay는 Subject계열인데 끊어지지 않는다(.value로 접근시 마지막 데이터 확인가능 = stateful)var rxTodosRelay: BehaviorRelay&lt;[RxTodo]&gt; = BehaviorRelay(value: RxTodo.getDumies())rxTodosRelay    .bind(to: myTableView.rx.items) { (tableView, row, element) in        guard let cell = tableView.dequeueReusableCell(withIdentifier: RxTodoCell.reuseIdentifier) as? RxTodoCell else { return UITableViewCell()}        cell.configure(with: element)        return cell    }    .disposed(by: disposeBag)이전 포스팅에서 아래와 같이 더미 데이터를 한 번만 방출하도록 설정하였다.  이 코드는 초기 데이터만 표시하고 변화가 될 수 없기 때문에 한계가 있다.// MARK: - 3초뒤 갱신DispatchQueue.main.asyncAfter(deadline: .now() + 3) {    self.rxTodosRelay.accept(RxTodo.getDumies(count: 3))}// MARK: - Rx스러운 3초뒤 갱신Observable.just(())    .delay(.seconds(3), scheduler: MainScheduler.instance) // Observable&lt;Void&gt;    .map { RxTodo.getDumies(count: 5) }                    // Observable&lt;[RxTodo]&gt;    .bind(onNext: self.rxTodosRelay.accept(_:))            // 같은 자료형이면 클로저가 들어갈 수 있다    .disposed(by: disposeBag)기존 딜레이 코드를 Rx스럽게 변경도 된다 동일한 로직이다.RxDataSourceRxDataSource는 Relay 같은 Observable이 갱신되면 렌더링이 된다.지금 코드에서 todosRelay를 BehaviorRelay로 사용한 이유는 마지막 데이터를 알아야 CRUD를 진행할 수 있기 때문이다.// MARK: - 버튼 연결addButton.rx.tap    .bind(onNext: { [weak self] _ in        guard let self = self else { return }        var currentTodos = self.rxTodosRelay.value // .value 하면 마지막에 보낸 데이터 할 수 있음        currentTodos.insert(RxTodo(), at: 0)       // 첫번째 열에 넣겠다        self.rxTodosRelay.accept(currentTodos)    })    .disposed(by: disposeBag)crud 기능을 위해 추가 버튼을 만들었다.   맨위에서부터 데이터를 들어가게 하기위해 insert를 사용했으나 아래에 넣고싶으면 append를 사용하면된다.// ✅ 2. (더 유연하지만 수동 캐스팅 필요 – RxCocoa)rxTodosRelay    .bind(to: myTableView.rx.items) { (tableView, row, element) in        guard let cell = tableView.dequeueReusableCell(withIdentifier: RxTodoCell.reuseIdentifier) as? RxTodoCell else { return UITableViewCell()}        cell.configure(with: element)                // MARK: - 셀의 delete버튼 선택되었을 때 액션을 여기서 처리        cell.deleteAction = { id in            let currentTodos = self.rxTodosRelay.value            let filteredTodos = currentTodos.filter { $0.id != id }            self.rxTodosRelay.accept(filteredTodos)        }                // MARK: - 셀의 토글 클릭시 액션을 여기서 처리        cell.isDoneChange = { [weak self] id, updatedIsDone in            guard let self = self else { return }            var currentTodos = self.rxTodosRelay.value            // 일치하는것 찾기            if let foundTodoIndex = currentTodos.firstIndex(where: { $0.id == id }) {                currentTodos[foundTodoIndex].isDone = updatedIsDone            }            self.rxTodosRelay.accept(currentTodos)        }                return cell    }    .disposed(by: disposeBag)커스텀 셀에서 만든 클로저 버튼 액션 내부 로직을 직접 구현해준다.  이제 두가지 문제가 있는데 다음 포스팅에서 진행하겠다.  버튼도 그냥 addTarget말고 Rx로 연결하는게 어떨까?  토글시 애니메이션이 전혀 없어서 어색하게 보인다전체 코드// Modelimport Fakeryimport UIKit// MARK: - Modelstruct RxTodo {    let id: UUID = UUID()    let title: String    var isDone: Bool    init(title: String? = nil,         isDone: Bool = false    ) {        self.title = title ?? &quot;터이틀: \(id.uuidString.prefix(8))&quot;        self.isDone = isDone    }    static func getDumies(count: Int = 10) -&gt; [RxTodo] {        let faker = Faker(locale: &quot;ko&quot;)        var result: [RxTodo] = []        for _ in 1...count {            let firstName = faker.name.firstName()            let lastName = faker.name.lastName()            let title = &quot;\(lastName) \(firstName)&quot;            result.append(RxTodo(title: title, isDone: false))        }        return result    }}// Cellimport UIKitimport RxSwiftimport RxCocoafinal class RxTodoCell: UITableViewCell {    var cellData: RxTodo? = nil    // MARK: - Rx    var disposeBag = DisposeBag()    var isDoneChange: ((_ id: UUID, _ newValue: Bool) -&gt; Void)? = nil    var deleteAction: ((_ id: UUID) -&gt; Void)? = nil    private let titleLabel: UILabel = {        let label = UILabel()        label.text = &quot;제목&quot;        label.numberOfLines = 1        label.font = UIFont.systemFont(ofSize: 14, weight: .bold)        return label    }()    private let idLabel: UILabel = {        let label = UILabel()        label.text = &quot;아이디&quot;        label.numberOfLines = 0        label.font = UIFont.systemFont(ofSize: 12, weight: .regular)        return label    }()    private lazy var isDoneSwitch: UISwitch = {        let sw = UISwitch()        return sw    }()    private lazy var deleteButton: UIButton = {        let btn = UIButton(type: .system)        btn.setTitle(&quot;Delete&quot;, for: .normal)        btn.widthAnchor.constraint(equalToConstant: 50).isActive = true        return btn    }()    private lazy var vStack: UIStackView = {        let stack = UIStackView(arrangedSubviews: [titleLabel, idLabel])        stack.axis = .vertical        stack.spacing = 8        return stack    }()    private lazy var hStack: UIStackView = {        let stack = UIStackView(arrangedSubviews: [vStack, isDoneSwitch, deleteButton])        stack.axis = .horizontal        stack.alignment = .center        stack.spacing = 20        return stack    }()    override init(style: UITableViewCell.CellStyle, reuseIdentifier: String?) {        super.init(style: style, reuseIdentifier: reuseIdentifier)        makeUI()        constraints()                // MARK: - 버튼 연결        isDoneSwitch.addTarget(self, action: #selector(handleIsDone), for: .valueChanged)        deleteButton.addTarget(self, action: #selector(handleDeleteButton), for: .touchUpInside)    }    required init?(coder: NSCoder) {        fatalError(&quot;init(coder:) has not been implemented&quot;)    }    private func makeUI() {        [hStack].forEach {            contentView.addSubview($0)            $0.translatesAutoresizingMaskIntoConstraints = false        }    }    private func constraints() {        NSLayoutConstraint.activate([            hStack.topAnchor.constraint(equalTo: contentView.topAnchor, constant: 10),            hStack.leadingAnchor.constraint(equalTo: contentView.leadingAnchor, constant: 20),            hStack.trailingAnchor.constraint(equalTo: contentView.trailingAnchor, constant: -20),            hStack.bottomAnchor.constraint(equalTo: contentView.bottomAnchor, constant: -10),        ])    }    override func prepareForReuse() {        super.prepareForReuse()        print(#fileID, #function, #line, &quot;prepareForReuse() - cellData.id: \(cellData?.id ?? UUID())&quot;)        self.disposeBag = DisposeBag()    }}extension RxTodoCell {    func configure(with todo: RxTodo) {        self.cellData = todo        titleLabel.text = todo.title        let idString = String(todo.id.uuidString.prefix(10))        idLabel.text = &quot;ID: \(idString)&quot;        isDoneSwitch.isOn = todo.isDone        // setRx()    }     // MARK: - 디버깅용    func configure(title: String, id: Int) {        titleLabel.text = title        idLabel.text = &quot;ID: \(id)&quot;        isDoneSwitch.isOn = false    }}extension RxTodoCell {    @objc func handleIsDone(_ sender: UISwitch) {        print(#fileID, #function, #line, &quot;- id: \(cellData?.id.uuidString ?? &quot;&quot;) sender: \(sender.isOn)&quot;)        guard let id = self.cellData?.id else { return }        isDoneChange?(id, sender.isOn)    }        @objc func handleDeleteButton(_ sender: UIButton) {        guard let id = self.cellData?.id else { return }        deleteAction?(id)    }}#if DEBUGimport SwiftUI// TodoCell 미리보기struct RxTodoCell_Preview: PreviewProvider {    static var previews: some View {        let cell = RxTodoCell()        cell.configure(title: &quot;할 일 예제&quot;, id: 42)        return cell.contentView            .getPreview()            .previewLayout(.fixed(width: 350, height: 100))            .background(Color.white)    }}#endif// ViewControllerimport UIKitimport RxSwiftimport RxCocoaimport RxRelayfinal class RxTodoViewController2: UIViewController {    // MARK: - 구독에 대한 찌꺼기 처리    var disposeBag =  DisposeBag()        // MARK: - Relay는 Subject계열인데 끊어지지 않는다(.value로 접근시 마지막 데이터 확인가능 = stateful)    var rxTodosRelay: BehaviorRelay&lt;[RxTodo]&gt; = BehaviorRelay(value: RxTodo.getDumies())    // MARK: - UI    private lazy var addButton = UIBarButtonItem(title: &quot;추가&quot;,                                                 style: .plain,                                                 target: nil,                                                 action: nil)    private lazy var myTableView: UITableView = {        let tv = UITableView()        return tv    }()    override func viewDidLoad() {        super.viewDidLoad()        view.backgroundColor = .white        makeUI()        constraints()                // MARK: - 코드기반 사용한다면        myTableView.register(RxTodoCell.self, forCellReuseIdentifier: &quot;RxTodoCell&quot;)                // ✅ 1. RxTodoCell을 타입으로 명시하여 바인딩하는 간결한 방식        /*         data.bind(to: myTableView.rx.items(cellIdentifier: RxTodoCell.reuseIdentifier,                                            cellType: RxTodoCell.self)) { index, model, cell in             cell.configure(with: model)         }        .disposed(by: disposeBag)         */                        // ✅ 2. (더 유연하지만 수동 캐스팅 필요 – RxCocoa)        rxTodosRelay            .bind(to: myTableView.rx.items) { (tableView, row, element) in                guard let cell = tableView.dequeueReusableCell(withIdentifier: RxTodoCell.reuseIdentifier) as? RxTodoCell else { return UITableViewCell()}                cell.configure(with: element)                                // MARK: - 셀의 delete버튼 선택되었을 때 액션을 여기서 처리                cell.deleteAction = { id in                    let currentTodos = self.rxTodosRelay.value                    let filteredTodos = currentTodos.filter { $0.id != id }                    self.rxTodosRelay.accept(filteredTodos)                }                                // MARK: - 셀의 토글 클릭시 액션을 여기서 처리                cell.isDoneChange = { [weak self] id, updatedIsDone in                    guard let self = self else { return }                    var currentTodos = self.rxTodosRelay.value                    // 일치하는것 찾기                    if let foundTodoIndex = currentTodos.firstIndex(where: { $0.id == id }) {                        currentTodos[foundTodoIndex].isDone = updatedIsDone                    }                    self.rxTodosRelay.accept(currentTodos)                }                                return cell            }            .disposed(by: disposeBag)                        // MARK: - 3초뒤 갱신        /*        DispatchQueue.main.asyncAfter(deadline: .now() + 3) {            self.rxTodosRelay.accept(RxTodo.getDumies(count: 3))        }         */                // MARK: - Rx스러운 3초뒤 갱신        /*        Observable.just(())            .delay(.seconds(3), scheduler: MainScheduler.instance) // Observable&lt;Void&gt;            .map { RxTodo.getDumies(count: 5) }                    // Observable&lt;[RxTodo]&gt;            .bind(onNext: self.rxTodosRelay.accept(_:))            // 같은 자료형이면 클로저가 들어갈 수 있다            .disposed(by: disposeBag)        */                // MARK: - 버튼 연결        addButton.rx.tap            .bind(onNext: { [weak self] _ in                guard let self = self else { return }                var currentTodos = self.rxTodosRelay.value // .value 하면 마지막에 보낸 데이터 할 수 있음                currentTodos.insert(RxTodo(), at: 0)       // 첫번째 열에 넣겠다                self.rxTodosRelay.accept(currentTodos)            })            .disposed(by: disposeBag)    }        private func makeUI() {        [myTableView].forEach {            view.addSubview($0)            $0.translatesAutoresizingMaskIntoConstraints = false        }                // 네비게이션 버튼        navigationItem.rightBarButtonItems = [addButton]    }        private func constraints() {        NSLayoutConstraint.activate([            myTableView.topAnchor.constraint(equalTo: view.safeAreaLayoutGuide.topAnchor),            myTableView.leadingAnchor.constraint(equalTo: view.leadingAnchor),            myTableView.trailingAnchor.constraint(equalTo: view.trailingAnchor),            myTableView.bottomAnchor.constraint(equalTo: view.bottomAnchor)        ])    }}">
    <meta itemprop="datePublished" content="2025-09-13T00:00:00+00:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title p-name" itemprop="headline">
            <a href="http://localhost:4000/RxDataSource-RxDataSource-4/" class="u-url" itemprop="url">[RxDataSource] 4. 버튼 액션을 클로저 이벤트로 전달하기
</a>
          </h1>
          <footer class="page__meta">
            
  



  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags : </strong>
    <span class="archive__item-tags">
    
    
    
      <a class="posttag tagged" href="/posts/?tag=ReactiveX">ReactiveX</a>
    
    
    
    
      <a class="posttag tagged" href="/posts/?tag=RxDataSource">RxDataSource</a>
    
    
    </span>  
  </p>



<!--  -->
            

  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Date :</strong> <time class="dt-published" datetime="2025-09-13T00:00:00+00:00">September 13, 2025</time></p>

          </footer>
        </header>
      

      <section class="page__content e-content" itemprop="text">
        
        <h1 id="기존-코드-개선">기존 코드 개선</h1>
<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// MARK: - 한번 그려지고 끝나기 때문에 추가/삭제같은 이벤트를 반영할 수 없다.</span>
<span class="k">let</span> <span class="nv">data</span> <span class="o">=</span> <span class="kt">Observable</span><span class="o">&lt;</span><span class="p">[</span><span class="kt">RxTodo</span><span class="p">]</span><span class="o">&gt;.</span><span class="nf">just</span><span class="p">(</span><span class="kt">RxTodo</span><span class="o">.</span><span class="nf">getDumies</span><span class="p">())</span>
<span class="n">data</span><span class="o">.</span><span class="nf">bind</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="n">myTableView</span><span class="o">.</span><span class="n">rx</span><span class="o">.</span><span class="nf">items</span><span class="p">(</span><span class="nv">cellIdentifier</span><span class="p">:</span> <span class="s">"RxTodoCell"</span><span class="p">,</span> <span class="nv">cellType</span><span class="p">:</span> <span class="kt">RxTodoCell</span><span class="o">.</span><span class="k">self</span><span class="p">))</span> <span class="p">{</span>
    <span class="n">index</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">cell</span> <span class="k">in</span>
    <span class="n">cell</span><span class="o">.</span><span class="nf">configure</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">model</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// =&gt; BehaviorRelay를 사용하여 단발성이 아닌 변화가능한 상태를 가진 스트림을 만들어서 사용하자.</span>
<span class="c1">// MARK: - Relay는 Subject계열인데 끊어지지 않는다(.value로 접근시 마지막 데이터 확인가능 = stateful)</span>
<span class="k">var</span> <span class="nv">rxTodosRelay</span><span class="p">:</span> <span class="kt">BehaviorRelay</span><span class="o">&lt;</span><span class="p">[</span><span class="kt">RxTodo</span><span class="p">]</span><span class="o">&gt;</span> <span class="o">=</span> <span class="kt">BehaviorRelay</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="kt">RxTodo</span><span class="o">.</span><span class="nf">getDumies</span><span class="p">())</span>
<span class="n">rxTodosRelay</span>
    <span class="o">.</span><span class="nf">bind</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="n">myTableView</span><span class="o">.</span><span class="n">rx</span><span class="o">.</span><span class="n">items</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="n">tableView</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">element</span><span class="p">)</span> <span class="k">in</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">cell</span> <span class="o">=</span> <span class="n">tableView</span><span class="o">.</span><span class="nf">dequeueReusableCell</span><span class="p">(</span><span class="nv">withIdentifier</span><span class="p">:</span> <span class="kt">RxTodoCell</span><span class="o">.</span><span class="n">reuseIdentifier</span><span class="p">)</span> <span class="k">as?</span> <span class="kt">RxTodoCell</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="kt">UITableViewCell</span><span class="p">()}</span>
        <span class="n">cell</span><span class="o">.</span><span class="nf">configure</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">element</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cell</span>
    <span class="p">}</span>
    <span class="o">.</span><span class="nf">disposed</span><span class="p">(</span><span class="nv">by</span><span class="p">:</span> <span class="n">disposeBag</span><span class="p">)</span>
</code></pre></div></div>
<p>이전 포스팅에서 아래와 같이 더미 데이터를 한 번만 방출하도록 설정하였다.  <br />
이 코드는 초기 데이터만 표시하고 변화가 될 수 없기 때문에 한계가 있다.<br />
<br /><br /><br /><br /></p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// MARK: - 3초뒤 갱신</span>
<span class="kt">DispatchQueue</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="nf">asyncAfter</span><span class="p">(</span><span class="nv">deadline</span><span class="p">:</span> <span class="o">.</span><span class="nf">now</span><span class="p">()</span> <span class="o">+</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">self</span><span class="o">.</span><span class="n">rxTodosRelay</span><span class="o">.</span><span class="nf">accept</span><span class="p">(</span><span class="kt">RxTodo</span><span class="o">.</span><span class="nf">getDumies</span><span class="p">(</span><span class="nv">count</span><span class="p">:</span> <span class="mi">3</span><span class="p">))</span>
<span class="p">}</span>

<span class="c1">// MARK: - Rx스러운 3초뒤 갱신</span>
<span class="kt">Observable</span><span class="o">.</span><span class="nf">just</span><span class="p">(())</span>
    <span class="o">.</span><span class="nf">delay</span><span class="p">(</span><span class="o">.</span><span class="nf">seconds</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="nv">scheduler</span><span class="p">:</span> <span class="kt">MainScheduler</span><span class="o">.</span><span class="n">instance</span><span class="p">)</span> <span class="c1">// Observable&lt;Void&gt;</span>
    <span class="o">.</span><span class="n">map</span> <span class="p">{</span> <span class="kt">RxTodo</span><span class="o">.</span><span class="nf">getDumies</span><span class="p">(</span><span class="nv">count</span><span class="p">:</span> <span class="mi">5</span><span class="p">)</span> <span class="p">}</span>                    <span class="c1">// Observable&lt;[RxTodo]&gt;</span>
    <span class="o">.</span><span class="nf">bind</span><span class="p">(</span><span class="nv">onNext</span><span class="p">:</span> <span class="k">self</span><span class="o">.</span><span class="n">rxTodosRelay</span><span class="o">.</span><span class="nf">accept</span><span class="p">(</span><span class="nv">_</span><span class="p">:))</span>            <span class="c1">// 같은 자료형이면 클로저가 들어갈 수 있다</span>
    <span class="o">.</span><span class="nf">disposed</span><span class="p">(</span><span class="nv">by</span><span class="p">:</span> <span class="n">disposeBag</span><span class="p">)</span>
</code></pre></div></div>
<p>기존 딜레이 코드를 Rx스럽게 변경도 된다 동일한 로직이다.<br />
<br /><br /><br /><br /></p>

<h1 id="rxdatasource">RxDataSource</h1>
<p>RxDataSource는 Relay 같은 Observable이 갱신되면 렌더링이 된다.<br />
지금 코드에서 todosRelay를 BehaviorRelay로 사용한 이유는 마지막 데이터를 알아야 CRUD를 진행할 수 있기 때문이다.<br />
<br /><br /><br /><br /></p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// MARK: - 버튼 연결</span>
<span class="n">addButton</span><span class="o">.</span><span class="n">rx</span><span class="o">.</span><span class="n">tap</span>
    <span class="o">.</span><span class="nf">bind</span><span class="p">(</span><span class="nv">onNext</span><span class="p">:</span> <span class="p">{</span> <span class="p">[</span><span class="k">weak</span> <span class="k">self</span><span class="p">]</span> <span class="n">_</span> <span class="k">in</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">self</span> <span class="o">=</span> <span class="k">self</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="p">}</span>
        <span class="k">var</span> <span class="nv">currentTodos</span> <span class="o">=</span> <span class="k">self</span><span class="o">.</span><span class="n">rxTodosRelay</span><span class="o">.</span><span class="n">value</span> <span class="c1">// .value 하면 마지막에 보낸 데이터 할 수 있음</span>
        <span class="n">currentTodos</span><span class="o">.</span><span class="nf">insert</span><span class="p">(</span><span class="kt">RxTodo</span><span class="p">(),</span> <span class="nv">at</span><span class="p">:</span> <span class="mi">0</span><span class="p">)</span>       <span class="c1">// 첫번째 열에 넣겠다</span>
        <span class="k">self</span><span class="o">.</span><span class="n">rxTodosRelay</span><span class="o">.</span><span class="nf">accept</span><span class="p">(</span><span class="n">currentTodos</span><span class="p">)</span>
    <span class="p">})</span>
    <span class="o">.</span><span class="nf">disposed</span><span class="p">(</span><span class="nv">by</span><span class="p">:</span> <span class="n">disposeBag</span><span class="p">)</span>
</code></pre></div></div>
<p>crud 기능을 위해 추가 버튼을 만들었다.   <br />
맨위에서부터 데이터를 들어가게 하기위해 insert를 사용했으나 아래에 넣고싶으면 append를 사용하면된다.<br />
<br /><br /><br /><br /></p>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ✅ 2. (더 유연하지만 수동 캐스팅 필요 – RxCocoa)</span>
<span class="n">rxTodosRelay</span>
    <span class="o">.</span><span class="nf">bind</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="n">myTableView</span><span class="o">.</span><span class="n">rx</span><span class="o">.</span><span class="n">items</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="n">tableView</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">element</span><span class="p">)</span> <span class="k">in</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">cell</span> <span class="o">=</span> <span class="n">tableView</span><span class="o">.</span><span class="nf">dequeueReusableCell</span><span class="p">(</span><span class="nv">withIdentifier</span><span class="p">:</span> <span class="kt">RxTodoCell</span><span class="o">.</span><span class="n">reuseIdentifier</span><span class="p">)</span> <span class="k">as?</span> <span class="kt">RxTodoCell</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="kt">UITableViewCell</span><span class="p">()}</span>
        <span class="n">cell</span><span class="o">.</span><span class="nf">configure</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">element</span><span class="p">)</span>
        
        <span class="c1">// MARK: - 셀의 delete버튼 선택되었을 때 액션을 여기서 처리</span>
        <span class="n">cell</span><span class="o">.</span><span class="n">deleteAction</span> <span class="o">=</span> <span class="p">{</span> <span class="n">id</span> <span class="k">in</span>
            <span class="k">let</span> <span class="nv">currentTodos</span> <span class="o">=</span> <span class="k">self</span><span class="o">.</span><span class="n">rxTodosRelay</span><span class="o">.</span><span class="n">value</span>
            <span class="k">let</span> <span class="nv">filteredTodos</span> <span class="o">=</span> <span class="n">currentTodos</span><span class="o">.</span><span class="n">filter</span> <span class="p">{</span> <span class="nv">$0</span><span class="o">.</span><span class="n">id</span> <span class="o">!=</span> <span class="n">id</span> <span class="p">}</span>
            <span class="k">self</span><span class="o">.</span><span class="n">rxTodosRelay</span><span class="o">.</span><span class="nf">accept</span><span class="p">(</span><span class="n">filteredTodos</span><span class="p">)</span>
        <span class="p">}</span>
        
        <span class="c1">// MARK: - 셀의 토글 클릭시 액션을 여기서 처리</span>
        <span class="n">cell</span><span class="o">.</span><span class="n">isDoneChange</span> <span class="o">=</span> <span class="p">{</span> <span class="p">[</span><span class="k">weak</span> <span class="k">self</span><span class="p">]</span> <span class="n">id</span><span class="p">,</span> <span class="n">updatedIsDone</span> <span class="k">in</span>
            <span class="k">guard</span> <span class="k">let</span> <span class="nv">self</span> <span class="o">=</span> <span class="k">self</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="p">}</span>
            <span class="k">var</span> <span class="nv">currentTodos</span> <span class="o">=</span> <span class="k">self</span><span class="o">.</span><span class="n">rxTodosRelay</span><span class="o">.</span><span class="n">value</span>
            <span class="c1">// 일치하는것 찾기</span>
            <span class="k">if</span> <span class="k">let</span> <span class="nv">foundTodoIndex</span> <span class="o">=</span> <span class="n">currentTodos</span><span class="o">.</span><span class="nf">firstIndex</span><span class="p">(</span><span class="nv">where</span><span class="p">:</span> <span class="p">{</span> <span class="nv">$0</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">id</span> <span class="p">})</span> <span class="p">{</span>
                <span class="n">currentTodos</span><span class="p">[</span><span class="n">foundTodoIndex</span><span class="p">]</span><span class="o">.</span><span class="n">isDone</span> <span class="o">=</span> <span class="n">updatedIsDone</span>
            <span class="p">}</span>
            <span class="k">self</span><span class="o">.</span><span class="n">rxTodosRelay</span><span class="o">.</span><span class="nf">accept</span><span class="p">(</span><span class="n">currentTodos</span><span class="p">)</span>
        <span class="p">}</span>
        
        <span class="k">return</span> <span class="n">cell</span>
    <span class="p">}</span>
    <span class="o">.</span><span class="nf">disposed</span><span class="p">(</span><span class="nv">by</span><span class="p">:</span> <span class="n">disposeBag</span><span class="p">)</span>
</code></pre></div></div>
<p>커스텀 셀에서 만든 클로저 버튼 액션 내부 로직을 직접 구현해준다.  <br />
이제 두가지 문제가 있는데 다음 포스팅에서 진행하겠다.</p>
<ul>
  <li>버튼도 그냥 addTarget말고 Rx로 연결하는게 어떨까?</li>
  <li>토글시 애니메이션이 전혀 없어서 어색하게 보인다<br />
<br /><br /><br /><br /></li>
</ul>

<h1 id="전체-코드">전체 코드</h1>
<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Model</span>
<span class="kd">import</span> <span class="kt">Fakery</span>
<span class="kd">import</span> <span class="kt">UIKit</span>

<span class="c1">// MARK: - Model</span>
<span class="kd">struct</span> <span class="kt">RxTodo</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">UUID</span> <span class="o">=</span> <span class="kt">UUID</span><span class="p">()</span>
    <span class="k">let</span> <span class="nv">title</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">var</span> <span class="nv">isDone</span><span class="p">:</span> <span class="kt">Bool</span>

    <span class="nf">init</span><span class="p">(</span><span class="nv">title</span><span class="p">:</span> <span class="kt">String</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span><span class="p">,</span>
         <span class="nv">isDone</span><span class="p">:</span> <span class="kt">Bool</span> <span class="o">=</span> <span class="kc">false</span>
    <span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span> <span class="p">??</span> <span class="s">"터이틀: </span><span class="se">\(</span><span class="n">id</span><span class="o">.</span><span class="n">uuidString</span><span class="o">.</span><span class="nf">prefix</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span><span class="se">)</span><span class="s">"</span>
        <span class="k">self</span><span class="o">.</span><span class="n">isDone</span> <span class="o">=</span> <span class="n">isDone</span>
    <span class="p">}</span>

    <span class="kd">static</span> <span class="kd">func</span> <span class="nf">getDumies</span><span class="p">(</span><span class="nv">count</span><span class="p">:</span> <span class="kt">Int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">[</span><span class="kt">RxTodo</span><span class="p">]</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">faker</span> <span class="o">=</span> <span class="kt">Faker</span><span class="p">(</span><span class="nv">locale</span><span class="p">:</span> <span class="s">"ko"</span><span class="p">)</span>
        <span class="k">var</span> <span class="nv">result</span><span class="p">:</span> <span class="p">[</span><span class="kt">RxTodo</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">_</span> <span class="k">in</span> <span class="mi">1</span><span class="o">...</span><span class="n">count</span> <span class="p">{</span>
            <span class="k">let</span> <span class="nv">firstName</span> <span class="o">=</span> <span class="n">faker</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="nf">firstName</span><span class="p">()</span>
            <span class="k">let</span> <span class="nv">lastName</span> <span class="o">=</span> <span class="n">faker</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="nf">lastName</span><span class="p">()</span>
            <span class="k">let</span> <span class="nv">title</span> <span class="o">=</span> <span class="s">"</span><span class="se">\(</span><span class="n">lastName</span><span class="se">)</span><span class="s"> </span><span class="se">\(</span><span class="n">firstName</span><span class="se">)</span><span class="s">"</span>
            <span class="n">result</span><span class="o">.</span><span class="nf">append</span><span class="p">(</span><span class="kt">RxTodo</span><span class="p">(</span><span class="nv">title</span><span class="p">:</span> <span class="n">title</span><span class="p">,</span> <span class="nv">isDone</span><span class="p">:</span> <span class="kc">false</span><span class="p">))</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Cell</span>
<span class="kd">import</span> <span class="kt">UIKit</span>
<span class="kd">import</span> <span class="kt">RxSwift</span>
<span class="kd">import</span> <span class="kt">RxCocoa</span>

<span class="kd">final</span> <span class="kd">class</span> <span class="kt">RxTodoCell</span><span class="p">:</span> <span class="kt">UITableViewCell</span> <span class="p">{</span>

    <span class="k">var</span> <span class="nv">cellData</span><span class="p">:</span> <span class="kt">RxTodo</span><span class="p">?</span> <span class="o">=</span> <span class="kc">nil</span>

    <span class="c1">// MARK: - Rx</span>
    <span class="k">var</span> <span class="nv">disposeBag</span> <span class="o">=</span> <span class="kt">DisposeBag</span><span class="p">()</span>
    <span class="k">var</span> <span class="nv">isDoneChange</span><span class="p">:</span> <span class="p">((</span><span class="n">_</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">UUID</span><span class="p">,</span> <span class="n">_</span> <span class="nv">newValue</span><span class="p">:</span> <span class="kt">Bool</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)?</span> <span class="o">=</span> <span class="kc">nil</span>
    <span class="k">var</span> <span class="nv">deleteAction</span><span class="p">:</span> <span class="p">((</span><span class="n">_</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">UUID</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kt">Void</span><span class="p">)?</span> <span class="o">=</span> <span class="kc">nil</span>

    <span class="kd">private</span> <span class="k">let</span> <span class="nv">titleLabel</span><span class="p">:</span> <span class="kt">UILabel</span> <span class="o">=</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">label</span> <span class="o">=</span> <span class="kt">UILabel</span><span class="p">()</span>
        <span class="n">label</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">"제목"</span>
        <span class="n">label</span><span class="o">.</span><span class="n">numberOfLines</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">label</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="kt">UIFont</span><span class="o">.</span><span class="nf">systemFont</span><span class="p">(</span><span class="nv">ofSize</span><span class="p">:</span> <span class="mi">14</span><span class="p">,</span> <span class="nv">weight</span><span class="p">:</span> <span class="o">.</span><span class="n">bold</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">label</span>
    <span class="p">}()</span>

    <span class="kd">private</span> <span class="k">let</span> <span class="nv">idLabel</span><span class="p">:</span> <span class="kt">UILabel</span> <span class="o">=</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">label</span> <span class="o">=</span> <span class="kt">UILabel</span><span class="p">()</span>
        <span class="n">label</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">"아이디"</span>
        <span class="n">label</span><span class="o">.</span><span class="n">numberOfLines</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">label</span><span class="o">.</span><span class="n">font</span> <span class="o">=</span> <span class="kt">UIFont</span><span class="o">.</span><span class="nf">systemFont</span><span class="p">(</span><span class="nv">ofSize</span><span class="p">:</span> <span class="mi">12</span><span class="p">,</span> <span class="nv">weight</span><span class="p">:</span> <span class="o">.</span><span class="n">regular</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">label</span>
    <span class="p">}()</span>

    <span class="kd">private</span> <span class="kd">lazy</span> <span class="k">var</span> <span class="nv">isDoneSwitch</span><span class="p">:</span> <span class="kt">UISwitch</span> <span class="o">=</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">sw</span> <span class="o">=</span> <span class="kt">UISwitch</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">sw</span>
    <span class="p">}()</span>

    <span class="kd">private</span> <span class="kd">lazy</span> <span class="k">var</span> <span class="nv">deleteButton</span><span class="p">:</span> <span class="kt">UIButton</span> <span class="o">=</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">btn</span> <span class="o">=</span> <span class="kt">UIButton</span><span class="p">(</span><span class="nv">type</span><span class="p">:</span> <span class="o">.</span><span class="n">system</span><span class="p">)</span>
        <span class="n">btn</span><span class="o">.</span><span class="nf">setTitle</span><span class="p">(</span><span class="s">"Delete"</span><span class="p">,</span> <span class="nv">for</span><span class="p">:</span> <span class="o">.</span><span class="n">normal</span><span class="p">)</span>
        <span class="n">btn</span><span class="o">.</span><span class="n">widthAnchor</span><span class="o">.</span><span class="nf">constraint</span><span class="p">(</span><span class="nv">equalToConstant</span><span class="p">:</span> <span class="mi">50</span><span class="p">)</span><span class="o">.</span><span class="n">isActive</span> <span class="o">=</span> <span class="kc">true</span>
        <span class="k">return</span> <span class="n">btn</span>
    <span class="p">}()</span>

    <span class="kd">private</span> <span class="kd">lazy</span> <span class="k">var</span> <span class="nv">vStack</span><span class="p">:</span> <span class="kt">UIStackView</span> <span class="o">=</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">stack</span> <span class="o">=</span> <span class="kt">UIStackView</span><span class="p">(</span><span class="nv">arrangedSubviews</span><span class="p">:</span> <span class="p">[</span><span class="n">titleLabel</span><span class="p">,</span> <span class="n">idLabel</span><span class="p">])</span>
        <span class="n">stack</span><span class="o">.</span><span class="n">axis</span> <span class="o">=</span> <span class="o">.</span><span class="n">vertical</span>
        <span class="n">stack</span><span class="o">.</span><span class="n">spacing</span> <span class="o">=</span> <span class="mi">8</span>
        <span class="k">return</span> <span class="n">stack</span>
    <span class="p">}()</span>

    <span class="kd">private</span> <span class="kd">lazy</span> <span class="k">var</span> <span class="nv">hStack</span><span class="p">:</span> <span class="kt">UIStackView</span> <span class="o">=</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">stack</span> <span class="o">=</span> <span class="kt">UIStackView</span><span class="p">(</span><span class="nv">arrangedSubviews</span><span class="p">:</span> <span class="p">[</span><span class="n">vStack</span><span class="p">,</span> <span class="n">isDoneSwitch</span><span class="p">,</span> <span class="n">deleteButton</span><span class="p">])</span>
        <span class="n">stack</span><span class="o">.</span><span class="n">axis</span> <span class="o">=</span> <span class="o">.</span><span class="n">horizontal</span>
        <span class="n">stack</span><span class="o">.</span><span class="n">alignment</span> <span class="o">=</span> <span class="o">.</span><span class="n">center</span>
        <span class="n">stack</span><span class="o">.</span><span class="n">spacing</span> <span class="o">=</span> <span class="mi">20</span>
        <span class="k">return</span> <span class="n">stack</span>
    <span class="p">}()</span>

    <span class="k">override</span> <span class="nf">init</span><span class="p">(</span><span class="nv">style</span><span class="p">:</span> <span class="kt">UITableViewCell</span><span class="o">.</span><span class="kt">CellStyle</span><span class="p">,</span> <span class="nv">reuseIdentifier</span><span class="p">:</span> <span class="kt">String</span><span class="p">?)</span> <span class="p">{</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">init</span><span class="p">(</span><span class="nv">style</span><span class="p">:</span> <span class="n">style</span><span class="p">,</span> <span class="nv">reuseIdentifier</span><span class="p">:</span> <span class="n">reuseIdentifier</span><span class="p">)</span>
        <span class="nf">makeUI</span><span class="p">()</span>
        <span class="nf">constraints</span><span class="p">()</span>
        
        <span class="c1">// MARK: - 버튼 연결</span>
        <span class="n">isDoneSwitch</span><span class="o">.</span><span class="nf">addTarget</span><span class="p">(</span><span class="k">self</span><span class="p">,</span> <span class="nv">action</span><span class="p">:</span> <span class="k">#selector</span><span class="p">(</span><span class="n">handleIsDone</span><span class="p">),</span> <span class="nv">for</span><span class="p">:</span> <span class="o">.</span><span class="n">valueChanged</span><span class="p">)</span>
        <span class="n">deleteButton</span><span class="o">.</span><span class="nf">addTarget</span><span class="p">(</span><span class="k">self</span><span class="p">,</span> <span class="nv">action</span><span class="p">:</span> <span class="k">#selector</span><span class="p">(</span><span class="n">handleDeleteButton</span><span class="p">),</span> <span class="nv">for</span><span class="p">:</span> <span class="o">.</span><span class="n">touchUpInside</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="kd">required</span> <span class="nf">init</span><span class="p">?(</span><span class="nv">coder</span><span class="p">:</span> <span class="kt">NSCoder</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">fatalError</span><span class="p">(</span><span class="s">"init(coder:) has not been implemented"</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="kd">private</span> <span class="kd">func</span> <span class="nf">makeUI</span><span class="p">()</span> <span class="p">{</span>
        <span class="p">[</span><span class="n">hStack</span><span class="p">]</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span>
            <span class="n">contentView</span><span class="o">.</span><span class="nf">addSubview</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span>
            <span class="nv">$0</span><span class="o">.</span><span class="n">translatesAutoresizingMaskIntoConstraints</span> <span class="o">=</span> <span class="kc">false</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">private</span> <span class="kd">func</span> <span class="nf">constraints</span><span class="p">()</span> <span class="p">{</span>
        <span class="kt">NSLayoutConstraint</span><span class="o">.</span><span class="nf">activate</span><span class="p">([</span>
            <span class="n">hStack</span><span class="o">.</span><span class="n">topAnchor</span><span class="o">.</span><span class="nf">constraint</span><span class="p">(</span><span class="nv">equalTo</span><span class="p">:</span> <span class="n">contentView</span><span class="o">.</span><span class="n">topAnchor</span><span class="p">,</span> <span class="nv">constant</span><span class="p">:</span> <span class="mi">10</span><span class="p">),</span>
            <span class="n">hStack</span><span class="o">.</span><span class="n">leadingAnchor</span><span class="o">.</span><span class="nf">constraint</span><span class="p">(</span><span class="nv">equalTo</span><span class="p">:</span> <span class="n">contentView</span><span class="o">.</span><span class="n">leadingAnchor</span><span class="p">,</span> <span class="nv">constant</span><span class="p">:</span> <span class="mi">20</span><span class="p">),</span>
            <span class="n">hStack</span><span class="o">.</span><span class="n">trailingAnchor</span><span class="o">.</span><span class="nf">constraint</span><span class="p">(</span><span class="nv">equalTo</span><span class="p">:</span> <span class="n">contentView</span><span class="o">.</span><span class="n">trailingAnchor</span><span class="p">,</span> <span class="nv">constant</span><span class="p">:</span> <span class="o">-</span><span class="mi">20</span><span class="p">),</span>
            <span class="n">hStack</span><span class="o">.</span><span class="n">bottomAnchor</span><span class="o">.</span><span class="nf">constraint</span><span class="p">(</span><span class="nv">equalTo</span><span class="p">:</span> <span class="n">contentView</span><span class="o">.</span><span class="n">bottomAnchor</span><span class="p">,</span> <span class="nv">constant</span><span class="p">:</span> <span class="o">-</span><span class="mi">10</span><span class="p">),</span>
        <span class="p">])</span>
    <span class="p">}</span>

    <span class="k">override</span> <span class="kd">func</span> <span class="nf">prepareForReuse</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">prepareForReuse</span><span class="p">()</span>
        <span class="nf">print</span><span class="p">(</span><span class="k">#fileID</span><span class="p">,</span> <span class="k">#function</span><span class="p">,</span> <span class="k">#line</span><span class="p">,</span> <span class="s">"prepareForReuse() - cellData.id: </span><span class="se">\(</span><span class="n">cellData</span><span class="p">?</span><span class="o">.</span><span class="n">id</span> <span class="p">??</span> <span class="kt">UUID</span><span class="p">()</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="k">self</span><span class="o">.</span><span class="n">disposeBag</span> <span class="o">=</span> <span class="kt">DisposeBag</span><span class="p">()</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">RxTodoCell</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">configure</span><span class="p">(</span><span class="n">with</span> <span class="nv">todo</span><span class="p">:</span> <span class="kt">RxTodo</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">self</span><span class="o">.</span><span class="n">cellData</span> <span class="o">=</span> <span class="n">todo</span>
        <span class="n">titleLabel</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">todo</span><span class="o">.</span><span class="n">title</span>

        <span class="k">let</span> <span class="nv">idString</span> <span class="o">=</span> <span class="kt">String</span><span class="p">(</span><span class="n">todo</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">uuidString</span><span class="o">.</span><span class="nf">prefix</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
        <span class="n">idLabel</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">"ID: </span><span class="se">\(</span><span class="n">idString</span><span class="se">)</span><span class="s">"</span>
        <span class="n">isDoneSwitch</span><span class="o">.</span><span class="n">isOn</span> <span class="o">=</span> <span class="n">todo</span><span class="o">.</span><span class="n">isDone</span>
        <span class="c1">// setRx()</span>
    <span class="p">}</span>
 
    <span class="c1">// MARK: - 디버깅용</span>
    <span class="kd">func</span> <span class="nf">configure</span><span class="p">(</span><span class="nv">title</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">Int</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">titleLabel</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">title</span>
        <span class="n">idLabel</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">"ID: </span><span class="se">\(</span><span class="n">id</span><span class="se">)</span><span class="s">"</span>
        <span class="n">isDoneSwitch</span><span class="o">.</span><span class="n">isOn</span> <span class="o">=</span> <span class="kc">false</span>

    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">RxTodoCell</span> <span class="p">{</span>
    <span class="kd">@objc</span> <span class="kd">func</span> <span class="nf">handleIsDone</span><span class="p">(</span><span class="n">_</span> <span class="nv">sender</span><span class="p">:</span> <span class="kt">UISwitch</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">print</span><span class="p">(</span><span class="k">#fileID</span><span class="p">,</span> <span class="k">#function</span><span class="p">,</span> <span class="k">#line</span><span class="p">,</span> <span class="s">"- id: </span><span class="se">\(</span><span class="n">cellData</span><span class="p">?</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">uuidString</span> <span class="p">??</span> <span class="s">""</span><span class="se">)</span><span class="s"> sender: </span><span class="se">\(</span><span class="n">sender</span><span class="o">.</span><span class="n">isOn</span><span class="se">)</span><span class="s">"</span><span class="p">)</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">id</span> <span class="o">=</span> <span class="k">self</span><span class="o">.</span><span class="n">cellData</span><span class="p">?</span><span class="o">.</span><span class="n">id</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="p">}</span>
        <span class="nf">isDoneChange</span><span class="p">?(</span><span class="n">id</span><span class="p">,</span> <span class="n">sender</span><span class="o">.</span><span class="n">isOn</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="kd">@objc</span> <span class="kd">func</span> <span class="nf">handleDeleteButton</span><span class="p">(</span><span class="n">_</span> <span class="nv">sender</span><span class="p">:</span> <span class="kt">UIButton</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">guard</span> <span class="k">let</span> <span class="nv">id</span> <span class="o">=</span> <span class="k">self</span><span class="o">.</span><span class="n">cellData</span><span class="p">?</span><span class="o">.</span><span class="n">id</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="p">}</span>
        <span class="nf">deleteAction</span><span class="p">?(</span><span class="n">id</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cp">#if DEBUG</span>
<span class="kd">import</span> <span class="kt">SwiftUI</span>
<span class="c1">// TodoCell 미리보기</span>
<span class="kd">struct</span> <span class="kt">RxTodoCell_Preview</span><span class="p">:</span> <span class="kt">PreviewProvider</span> <span class="p">{</span>
    <span class="kd">static</span> <span class="k">var</span> <span class="nv">previews</span><span class="p">:</span> <span class="kd">some</span> <span class="kt">View</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">cell</span> <span class="o">=</span> <span class="kt">RxTodoCell</span><span class="p">()</span>
        <span class="n">cell</span><span class="o">.</span><span class="nf">configure</span><span class="p">(</span><span class="nv">title</span><span class="p">:</span> <span class="s">"할 일 예제"</span><span class="p">,</span> <span class="nv">id</span><span class="p">:</span> <span class="mi">42</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cell</span><span class="o">.</span><span class="n">contentView</span>
            <span class="o">.</span><span class="nf">getPreview</span><span class="p">()</span>
            <span class="o">.</span><span class="nf">previewLayout</span><span class="p">(</span><span class="o">.</span><span class="nf">fixed</span><span class="p">(</span><span class="nv">width</span><span class="p">:</span> <span class="mi">350</span><span class="p">,</span> <span class="nv">height</span><span class="p">:</span> <span class="mi">100</span><span class="p">))</span>
            <span class="o">.</span><span class="nf">background</span><span class="p">(</span><span class="kt">Color</span><span class="o">.</span><span class="n">white</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="cp">#endif</span>
</code></pre></div></div>

<div class="language-swift highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ViewController</span>
<span class="kd">import</span> <span class="kt">UIKit</span>
<span class="kd">import</span> <span class="kt">RxSwift</span>
<span class="kd">import</span> <span class="kt">RxCocoa</span>
<span class="kd">import</span> <span class="kt">RxRelay</span>

<span class="kd">final</span> <span class="kd">class</span> <span class="kt">RxTodoViewController2</span><span class="p">:</span> <span class="kt">UIViewController</span> <span class="p">{</span>

    <span class="c1">// MARK: - 구독에 대한 찌꺼기 처리</span>
    <span class="k">var</span> <span class="nv">disposeBag</span> <span class="o">=</span>  <span class="kt">DisposeBag</span><span class="p">()</span>
    
    <span class="c1">// MARK: - Relay는 Subject계열인데 끊어지지 않는다(.value로 접근시 마지막 데이터 확인가능 = stateful)</span>
    <span class="k">var</span> <span class="nv">rxTodosRelay</span><span class="p">:</span> <span class="kt">BehaviorRelay</span><span class="o">&lt;</span><span class="p">[</span><span class="kt">RxTodo</span><span class="p">]</span><span class="o">&gt;</span> <span class="o">=</span> <span class="kt">BehaviorRelay</span><span class="p">(</span><span class="nv">value</span><span class="p">:</span> <span class="kt">RxTodo</span><span class="o">.</span><span class="nf">getDumies</span><span class="p">())</span>

    <span class="c1">// MARK: - UI</span>
    <span class="kd">private</span> <span class="kd">lazy</span> <span class="k">var</span> <span class="nv">addButton</span> <span class="o">=</span> <span class="kt">UIBarButtonItem</span><span class="p">(</span><span class="nv">title</span><span class="p">:</span> <span class="s">"추가"</span><span class="p">,</span>
                                                 <span class="nv">style</span><span class="p">:</span> <span class="o">.</span><span class="n">plain</span><span class="p">,</span>
                                                 <span class="nv">target</span><span class="p">:</span> <span class="kc">nil</span><span class="p">,</span>
                                                 <span class="nv">action</span><span class="p">:</span> <span class="kc">nil</span><span class="p">)</span>

    <span class="kd">private</span> <span class="kd">lazy</span> <span class="k">var</span> <span class="nv">myTableView</span><span class="p">:</span> <span class="kt">UITableView</span> <span class="o">=</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">tv</span> <span class="o">=</span> <span class="kt">UITableView</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">tv</span>
    <span class="p">}()</span>

    <span class="k">override</span> <span class="kd">func</span> <span class="nf">viewDidLoad</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">super</span><span class="o">.</span><span class="nf">viewDidLoad</span><span class="p">()</span>
        <span class="n">view</span><span class="o">.</span><span class="n">backgroundColor</span> <span class="o">=</span> <span class="o">.</span><span class="n">white</span>
        <span class="nf">makeUI</span><span class="p">()</span>
        <span class="nf">constraints</span><span class="p">()</span>
        
        <span class="c1">// MARK: - 코드기반 사용한다면</span>
        <span class="n">myTableView</span><span class="o">.</span><span class="nf">register</span><span class="p">(</span><span class="kt">RxTodoCell</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">forCellReuseIdentifier</span><span class="p">:</span> <span class="s">"RxTodoCell"</span><span class="p">)</span>
        
        <span class="c1">// ✅ 1. RxTodoCell을 타입으로 명시하여 바인딩하는 간결한 방식</span>
        <span class="cm">/*
         data.bind(to: myTableView.rx.items(cellIdentifier: RxTodoCell.reuseIdentifier,
                                            cellType: RxTodoCell.self)) { index, model, cell in
             cell.configure(with: model)
         }
        .disposed(by: disposeBag)
         */</span>
        
        
        <span class="c1">// ✅ 2. (더 유연하지만 수동 캐스팅 필요 – RxCocoa)</span>
        <span class="n">rxTodosRelay</span>
            <span class="o">.</span><span class="nf">bind</span><span class="p">(</span><span class="nv">to</span><span class="p">:</span> <span class="n">myTableView</span><span class="o">.</span><span class="n">rx</span><span class="o">.</span><span class="n">items</span><span class="p">)</span> <span class="p">{</span> <span class="p">(</span><span class="n">tableView</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">element</span><span class="p">)</span> <span class="k">in</span>
                <span class="k">guard</span> <span class="k">let</span> <span class="nv">cell</span> <span class="o">=</span> <span class="n">tableView</span><span class="o">.</span><span class="nf">dequeueReusableCell</span><span class="p">(</span><span class="nv">withIdentifier</span><span class="p">:</span> <span class="kt">RxTodoCell</span><span class="o">.</span><span class="n">reuseIdentifier</span><span class="p">)</span> <span class="k">as?</span> <span class="kt">RxTodoCell</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="kt">UITableViewCell</span><span class="p">()}</span>
                <span class="n">cell</span><span class="o">.</span><span class="nf">configure</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">element</span><span class="p">)</span>
                
                <span class="c1">// MARK: - 셀의 delete버튼 선택되었을 때 액션을 여기서 처리</span>
                <span class="n">cell</span><span class="o">.</span><span class="n">deleteAction</span> <span class="o">=</span> <span class="p">{</span> <span class="n">id</span> <span class="k">in</span>
                    <span class="k">let</span> <span class="nv">currentTodos</span> <span class="o">=</span> <span class="k">self</span><span class="o">.</span><span class="n">rxTodosRelay</span><span class="o">.</span><span class="n">value</span>
                    <span class="k">let</span> <span class="nv">filteredTodos</span> <span class="o">=</span> <span class="n">currentTodos</span><span class="o">.</span><span class="n">filter</span> <span class="p">{</span> <span class="nv">$0</span><span class="o">.</span><span class="n">id</span> <span class="o">!=</span> <span class="n">id</span> <span class="p">}</span>
                    <span class="k">self</span><span class="o">.</span><span class="n">rxTodosRelay</span><span class="o">.</span><span class="nf">accept</span><span class="p">(</span><span class="n">filteredTodos</span><span class="p">)</span>
                <span class="p">}</span>
                
                <span class="c1">// MARK: - 셀의 토글 클릭시 액션을 여기서 처리</span>
                <span class="n">cell</span><span class="o">.</span><span class="n">isDoneChange</span> <span class="o">=</span> <span class="p">{</span> <span class="p">[</span><span class="k">weak</span> <span class="k">self</span><span class="p">]</span> <span class="n">id</span><span class="p">,</span> <span class="n">updatedIsDone</span> <span class="k">in</span>
                    <span class="k">guard</span> <span class="k">let</span> <span class="nv">self</span> <span class="o">=</span> <span class="k">self</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="p">}</span>
                    <span class="k">var</span> <span class="nv">currentTodos</span> <span class="o">=</span> <span class="k">self</span><span class="o">.</span><span class="n">rxTodosRelay</span><span class="o">.</span><span class="n">value</span>
                    <span class="c1">// 일치하는것 찾기</span>
                    <span class="k">if</span> <span class="k">let</span> <span class="nv">foundTodoIndex</span> <span class="o">=</span> <span class="n">currentTodos</span><span class="o">.</span><span class="nf">firstIndex</span><span class="p">(</span><span class="nv">where</span><span class="p">:</span> <span class="p">{</span> <span class="nv">$0</span><span class="o">.</span><span class="n">id</span> <span class="o">==</span> <span class="n">id</span> <span class="p">})</span> <span class="p">{</span>
                        <span class="n">currentTodos</span><span class="p">[</span><span class="n">foundTodoIndex</span><span class="p">]</span><span class="o">.</span><span class="n">isDone</span> <span class="o">=</span> <span class="n">updatedIsDone</span>
                    <span class="p">}</span>
                    <span class="k">self</span><span class="o">.</span><span class="n">rxTodosRelay</span><span class="o">.</span><span class="nf">accept</span><span class="p">(</span><span class="n">currentTodos</span><span class="p">)</span>
                <span class="p">}</span>
                
                <span class="k">return</span> <span class="n">cell</span>
            <span class="p">}</span>
            <span class="o">.</span><span class="nf">disposed</span><span class="p">(</span><span class="nv">by</span><span class="p">:</span> <span class="n">disposeBag</span><span class="p">)</span>
        
        
        <span class="c1">// MARK: - 3초뒤 갱신</span>
        <span class="cm">/*
        DispatchQueue.main.asyncAfter(deadline: .now() + 3) {
            self.rxTodosRelay.accept(RxTodo.getDumies(count: 3))
        }
         */</span>
        
        <span class="c1">// MARK: - Rx스러운 3초뒤 갱신</span>
        <span class="cm">/*
        Observable.just(())
            .delay(.seconds(3), scheduler: MainScheduler.instance) // Observable&lt;Void&gt;
            .map { RxTodo.getDumies(count: 5) }                    // Observable&lt;[RxTodo]&gt;
            .bind(onNext: self.rxTodosRelay.accept(_:))            // 같은 자료형이면 클로저가 들어갈 수 있다
            .disposed(by: disposeBag)
        */</span>
        
        <span class="c1">// MARK: - 버튼 연결</span>
        <span class="n">addButton</span><span class="o">.</span><span class="n">rx</span><span class="o">.</span><span class="n">tap</span>
            <span class="o">.</span><span class="nf">bind</span><span class="p">(</span><span class="nv">onNext</span><span class="p">:</span> <span class="p">{</span> <span class="p">[</span><span class="k">weak</span> <span class="k">self</span><span class="p">]</span> <span class="n">_</span> <span class="k">in</span>
                <span class="k">guard</span> <span class="k">let</span> <span class="nv">self</span> <span class="o">=</span> <span class="k">self</span> <span class="k">else</span> <span class="p">{</span> <span class="k">return</span> <span class="p">}</span>
                <span class="k">var</span> <span class="nv">currentTodos</span> <span class="o">=</span> <span class="k">self</span><span class="o">.</span><span class="n">rxTodosRelay</span><span class="o">.</span><span class="n">value</span> <span class="c1">// .value 하면 마지막에 보낸 데이터 할 수 있음</span>
                <span class="n">currentTodos</span><span class="o">.</span><span class="nf">insert</span><span class="p">(</span><span class="kt">RxTodo</span><span class="p">(),</span> <span class="nv">at</span><span class="p">:</span> <span class="mi">0</span><span class="p">)</span>       <span class="c1">// 첫번째 열에 넣겠다</span>
                <span class="k">self</span><span class="o">.</span><span class="n">rxTodosRelay</span><span class="o">.</span><span class="nf">accept</span><span class="p">(</span><span class="n">currentTodos</span><span class="p">)</span>
            <span class="p">})</span>
            <span class="o">.</span><span class="nf">disposed</span><span class="p">(</span><span class="nv">by</span><span class="p">:</span> <span class="n">disposeBag</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="kd">private</span> <span class="kd">func</span> <span class="nf">makeUI</span><span class="p">()</span> <span class="p">{</span>
        <span class="p">[</span><span class="n">myTableView</span><span class="p">]</span><span class="o">.</span><span class="n">forEach</span> <span class="p">{</span>
            <span class="n">view</span><span class="o">.</span><span class="nf">addSubview</span><span class="p">(</span><span class="nv">$0</span><span class="p">)</span>
            <span class="nv">$0</span><span class="o">.</span><span class="n">translatesAutoresizingMaskIntoConstraints</span> <span class="o">=</span> <span class="kc">false</span>
        <span class="p">}</span>
        
        <span class="c1">// 네비게이션 버튼</span>
        <span class="n">navigationItem</span><span class="o">.</span><span class="n">rightBarButtonItems</span> <span class="o">=</span> <span class="p">[</span><span class="n">addButton</span><span class="p">]</span>
    <span class="p">}</span>
    
    <span class="kd">private</span> <span class="kd">func</span> <span class="nf">constraints</span><span class="p">()</span> <span class="p">{</span>
        <span class="kt">NSLayoutConstraint</span><span class="o">.</span><span class="nf">activate</span><span class="p">([</span>
            <span class="n">myTableView</span><span class="o">.</span><span class="n">topAnchor</span><span class="o">.</span><span class="nf">constraint</span><span class="p">(</span><span class="nv">equalTo</span><span class="p">:</span> <span class="n">view</span><span class="o">.</span><span class="n">safeAreaLayoutGuide</span><span class="o">.</span><span class="n">topAnchor</span><span class="p">),</span>
            <span class="n">myTableView</span><span class="o">.</span><span class="n">leadingAnchor</span><span class="o">.</span><span class="nf">constraint</span><span class="p">(</span><span class="nv">equalTo</span><span class="p">:</span> <span class="n">view</span><span class="o">.</span><span class="n">leadingAnchor</span><span class="p">),</span>
            <span class="n">myTableView</span><span class="o">.</span><span class="n">trailingAnchor</span><span class="o">.</span><span class="nf">constraint</span><span class="p">(</span><span class="nv">equalTo</span><span class="p">:</span> <span class="n">view</span><span class="o">.</span><span class="n">trailingAnchor</span><span class="p">),</span>
            <span class="n">myTableView</span><span class="o">.</span><span class="n">bottomAnchor</span><span class="o">.</span><span class="nf">constraint</span><span class="p">(</span><span class="nv">equalTo</span><span class="p">:</span> <span class="n">view</span><span class="o">.</span><span class="n">bottomAnchor</span><span class="p">)</span>
        <span class="p">])</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>

        
      </section>

      

      
  <nav class="pagination">
    
      <a href="/RxDataSource-RxDataSource-3/" class="pagination--pager" title="[RxDataSource] 3. Rx로 테이블 사용해보기
">Previous</a>
    
    
      <a href="/RxDataSource-RxDataSource-5/" class="pagination--pager" title="[RxDataSource] 5. 버튼 액션을 Rx로 연결하기
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';" role="search">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
          <li><a href="https://github.com/indextrown" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i> GitHub</a></li>
        
      
    

    
      <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2025 indextrown. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

<script src="/assets/js/jqcloud.min.js" charset="utf-8"></script>
      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>



    <script>
  'use strict';

  var theme = localStorage.getItem('theme');

  (function() {
    var commentContainer = document.querySelector('#utterances-comments');

    if (!commentContainer) {
      return;
    }

    var script = document.createElement('script');
    script.setAttribute('src', 'https://utteranc.es/client.js');
    script.setAttribute('repo', 'indextrown/indextrown.github.io');
    script.setAttribute('issue-term', 'pathname');
    

    if (theme === 'dark') {
      script.setAttribute('theme', 'github-dark');
    } else {
      script.setAttribute('theme', 'github-light');
    }
    script.setAttribute('crossorigin', 'anonymous');

    commentContainer.appendChild(script);
  })();
</script>

  





    <aside class="sidebar__home">
      <a href="/posts">
        <div style="font-size: 0.5rem;"><i class="fas fa-h-square fa-5x"></i></div>
      </a>
    </aside>

    <aside class="sidebar__top">
      <a href="#site-nav">
        <div style="font-size: 0.5rem;"><i class="fas fa-caret-square-up fa-5x"></i></div>
      </a>
    </aside>

    <aside class="sidebar__bottom">
      <a href="#footer">
        <div style="font-size: 0.5rem;"><i class="fas fa-caret-square-down fa-5x"></i></div>
      </a>
    </aside>

  </body>
</html>
